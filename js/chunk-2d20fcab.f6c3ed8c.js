(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d20fcab"],{b4ad:function(e,t,i){"use strict";i.r(t);var l=i("e814"),a=i.n(l),s=i("c276"),n=i("1684"),d=i("42a2"),o={data:function(){return{leftHeight:"height:"+(window.innerHeight-50)+"px",fileList:[],uploadFile:{},addExtendFileDialog:!1,selectIndex:-1,selectFile:{local_name:"选着文件"},uploadFileList:[],uploadHeader:{"X-token":s.a.cookies.get("token"),"X-user-id":s.a.cookies.get("user"),"X-user-name":s.a.cookies.get("userName")},newFileName:"",newFilePath:"",newFileDescribe:"",newFileObj:{},extendFileRecord:[],uploadExtendFileDialog:!1,uploadFileDescribe:"",uploadFileRecord:{}}},created:function(){this.myInit()},mounted:function(){},methods:{myInit:function(){this.getSoftwareExtend()},selectExtendFile:function(e,t){this.selectFile=e,this.selectIndex=t,this.getSoftwareExtendFileRecord(e)},getSoftwareExtendFileRecord:function(e){var t=this,i={software_extend_id:e.id};Object(n.f)(i).then(function(e){for(var i=0;i<e.length;i++){var l=e[i].upload_time;e[i].upload_time_str=t.$task.stampToDateM(l)}t.extendFileRecord=e}).catch(function(e){})},getSoftwareExtend:function(e){var t=this,i={software_id:this.$task.softId};Object(n.e)(i).then(function(e){t.fileList=e})},addExtendFileBtn:function(){this.addExtendFileDialog=!0},uploadsuccess:function(e,t,i){try{this.uploadFile=JSON.parse(Object(d.a)(e)),this.uploadFile.size=i[0].raw.size,this.uploadFile.mtime=i[0].raw.lastModified}catch(e){this.uploadFile={}}},handleRemove:function(e,t){},handlePreview:function(e){},handleExceed:function(e,t){},beforeRemove:function(e,t){},submitExtendFile:function(){var e=this;""==this.newFilePath&&this.$message({message:"请填写文件信息",type:"warning"});var t=this.uploadFile.data;if(t){var i=t.path,l=i.slice(i.lastIndexOf("/")+1,i.length),s=t.disk_id,d=this.uploadFile.size,o=a()(this.uploadFile.mtime);o=a()(o/1e3);var c=this.newFilePath,r=c.slice(c.lastIndexOf("/")+1,c.length),u=c.slice(0,c.lastIndexOf("/")),p={software_id:this.$task.softId,name:this.newFileName,local_name:r,local_path:u,serve_name:l,server_path:i,size:d,mtime:o,describe:this.newFileDescribe,disk_id:s};Object(n.a)(p).then(function(){e.addExtendFileDialog=!1,e.newFileDescribe=""}).catch(function(t){e.$message({message:"添加失败",type:"warning"}),e.addExtendFileDialog=!1})}else this.$message({message:"请上传文件",type:"warning"})},updataExtendFileBtn:function(){this.uploadExtendFileDialog=!0},uploadsuccess2:function(e,t,i){try{this.uploadFileRecord=JSON.parse(Object(d.a)(e)),this.uploadFileRecord.size=i[0].raw.size,this.uploadFileRecord.mtime=i[0].raw.lastModified}catch(e){this.uploadFileRecord={}}},handleRemove2:function(e,t){},handlePreview2:function(e){},handleExceed2:function(e,t){},beforeRemove2:function(e,t){},submitUploadExtendFile:function(){var e=this,t=this.uploadFileRecord.data;if(t){var i=t.path,l=i.slice(i.lastIndexOf("/")+1,i.length),s=t.disk_id,d=this.uploadFileRecord.size,o=a()(this.uploadFileRecord.mtime);o=a()(o/1e3);var c={software_extend_id:this.selectFile.id,serve_name:l,server_path:i,size:d,mtime:o,describe:this.uploadFileDescribe,disk_id:s};Object(n.g)(c).then(function(){e.uploadExtendFileDialog=!1,e.getSoftwareExtendFileRecord(e.selectFile),e.uploadFileDescribe=""}).catch(function(t){e.$message({message:"添加失败",type:"warning"}),e.uploadExtendFileDialog=!1})}else this.$message({message:"请上传文件",type:"warning"})}}},c=i("2877"),r=Object(c.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("d2-container",[i("el-row",[i("el-col",{attrs:{span:8}},[i("div",{staticClass:"extendFileLeftBox"},[i("div",{staticClass:"extendFileTitle"},[e._v("\n            脚本列表\n            "),i("div",{staticClass:"extendFileInput"},[i("el-input",{attrs:{placeholder:"搜索",size:"mini",clearable:""}})],1),i("div",{staticClass:"extendFileBtns"},[i("el-button",{attrs:{size:"mini"},on:{click:e.addExtendFileBtn}},[e._v("添加文件")])],1)]),i("div",{staticClass:"extendFileBox"},[i("el-scrollbar",{style:e.leftHeight},e._l(e.fileList,function(t,l){return i("div",{key:l,class:l==e.selectIndex?"extendFileList extendFileListSelect":"extendFileList",on:{click:function(i){return e.selectExtendFile(t,l)}}},[i("div",{staticClass:"extendFileName"},[e._v("\n                  "+e._s(t.name)+"\n                ")]),i("div",{staticClass:"extendFileName"},[e._v("\n                  "+e._s(t.local_name)+"\n                ")]),i("div",{staticClass:"extendFilePath"},[e._v("\n                  "+e._s(t.local_path)+"\n                ")])])}),0)],1)])]),i("el-col",{attrs:{span:16}},[i("div",{staticClass:"extendFileRightBox"},[i("div",{staticClass:"extendFileRecordTitle"},[e._v("\n            "+e._s(e.selectFile.local_name)+"\n            "),i("div",{staticClass:"extendFileRecordBtn"},[i("el-button",{attrs:{size:"mini"},on:{click:e.updataExtendFileBtn}},[e._v("更新版本")])],1)]),i("div",{staticClass:"extendFileRecordBox"},[i("el-scrollbar",{style:e.leftHeight},e._l(e.extendFileRecord,function(t){return i("div",{staticClass:"extendFileRecordList"},[i("div",{staticClass:"extendFileRecordContent"},[e._v("\n                  "+e._s(t.describe)+"\n                ")]),i("div",{staticClass:"extendFileRecordTime"},[e._v("\n                  "+e._s(t.personnel_name)+" "+e._s(t.upload_time_str)+"\n                ")])])}),0)],1)])])],1),i("el-dialog",{attrs:{title:"添加脚本文件",visible:e.addExtendFileDialog,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.addExtendFileDialog=t}}},[i("div",{staticClass:"addExtendFilePath"},[i("el-input",{attrs:{type:"input",rows:2,placeholder:"文件中文名"},model:{value:e.newFileName,callback:function(t){e.newFileName=t},expression:"newFileName"}})],1),i("div",{staticClass:"addExtendFilePath"},[i("el-input",{attrs:{type:"input",rows:2,placeholder:"文件路径"},model:{value:e.newFilePath,callback:function(t){e.newFilePath=t},expression:"newFilePath"}})],1),i("div",{staticClass:"addExtendFileTextarea"},[i("el-input",{attrs:{type:"textarea",rows:2,placeholder:"版本描述"},model:{value:e.newFileDescribe,callback:function(t){e.newFileDescribe=t},expression:"newFileDescribe"}})],1),i("div",{staticClass:"addExtendFileUpload"},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"http://aniapi.tgyc.com/index.php/home/upload/upload_disk",headers:e.uploadHeader,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-success":e.uploadsuccess,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.uploadFileList}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.addExtendFileDialog=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.submitExtendFile}},[e._v("确 定")])],1)]),i("el-dialog",{attrs:{title:"更新脚本文件",visible:e.uploadExtendFileDialog,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.uploadExtendFileDialog=t}}},[i("div",{staticClass:"addExtendFileTextarea"},[i("el-input",{attrs:{type:"textarea",rows:2,placeholder:"版本描述"},model:{value:e.uploadFileDescribe,callback:function(t){e.uploadFileDescribe=t},expression:"uploadFileDescribe"}})],1),i("div",{staticClass:"addExtendFileUpload"},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"http://aniapi.tgyc.com/index.php/home/upload/upload_disk",headers:e.uploadHeader,"on-preview":e.handlePreview2,"on-remove":e.handleRemove2,"before-remove":e.beforeRemove2,"on-success":e.uploadsuccess2,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.uploadFileList}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.uploadExtendFileDialog=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.submitUploadExtendFile}},[e._v("确 定")])],1)])],1)},[],!1,null,null,null);r.options.__file="extendFile.vue";t.default=r.exports}}]);
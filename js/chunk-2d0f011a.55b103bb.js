(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0f011a"],{"9b94":function(t,e,s){"use strict";s.r(e);s("7f7f"),s("20d6");var i=s("f499"),a=s.n(i),n=s("cebc"),l=(s("cadf"),s("551c"),s("097d"),s("5990")),d=s("2f62"),o=s("c276"),c={data:function(){var t=this;return{assetId:"",assetInfo:{},assetsMinPlay:[],assetsPlayList:[],fileListHeight:"height:".concat(window.innerHeight-120,"px;"),assetFileList:[],assetRefList:[],updataList:[],project_path:"",updataEvent:function(e){t.setUpdataData(e.thdata)},updataDialog:!1}},computed:Object(n.a)({},Object(d.e)("d2admin/user",["info"])),created:function(){this.UEListenerEvent(),this.assetId=this.$route.query.id,this.assetId&&(this.getassetsIntro(),this.getassetsPlay(),this.getassetsRefFile(),this.getassetsRefAsset())},destroyed:function(){this.delUEListenerEvent()},mounted:function(){var t=this;window.onresize=function(){t.fileListHeight="height:"+(window.innerHeight-120)+"px"}},methods:{getassetsIntro:function(){var t=this,e={id:this.assetId};Object(l.w)(e).then(function(e){t.assetInfo=e})},getassetsPlay:function(){var t=this,e={id:this.assetId};Object(l.z)(e).then(function(e){for(var s=[],i=[],a=0;a<e.length;a++)e[a].allPath=t.$task.imgBaseUrl+e[a].www_path+e[a].server_path,"0"==e[a].type?s.push(e[a]):i.push(e[a]);t.assetsPlayList=i,t.assetsMinPlay=s})},getassetsRefFile:function(){var t=this,e={assets_id:this.assetId};Object(l.B)(e).then(function(e){t.assetFileList=e})},getassetsRefAsset:function(){var t=this,e={assets_id:this.assetId};Object(l.A)(e).then(function(e){t.assetRefList=e})},assetUpdataCtr:function(){var t=this.$task.buleEventScript.ObjectPath,e=a()({return_function_name:"ue_update_asset"});window.ue.obj.webrunblueevent(t,"webbatchupdataEvent",e)},UEListenerEvent:function(){window.addEventListener("ue_update_asset",this.updataEvent)},delUEListenerEvent:function(){window.removeEventListener("ue_update_asset",this.updataEvent)},setUpdataData:function(t){var e=this;if(0!=t.length){var s=t[0].ref_file,i=[];window.ue.obj.webgetdownloadprojectpath().then(function(t){e.project_path=t;for(var a=0;a<s.length;a++){var n=s[a],l=n.slice(n.lastIndexOf("/")+1,n.length),d=e.$task.getFileTypeName(l);i.push({name:l,file_type:d,project_path:t,all_path:t+s[a],local_path:n,mtime:"",state:0})}e.updataDialog=!0,e.updataList=i})}},submitUpdata:function(){for(var t=this,e=[],s=this.assetFileList,i=this.updataList,n=0;n<s.length;n++){var d=s[n].local_path;i.findIndex(function(t){return t.local_path==d})>-1||e.push(s[n])}var c=function(){for(var e=!0,s=0;s<i.length;s++)if(0==i[s].state){e=!1;break}e&&(t.updataDialog=!1,t.$notify({title:"通知",message:"上传完成",position:"bottom-right"}))},f=function(e){var s=o.a.file.getRnadomFiveInt(),n=o.a.file.diskPath+"/"+s+"."+i[e].file_type,d="/"+s+"."+i[e].file_type,f={name:i[e].name,id:i[e].all_path,type:"up",localPath:i[e].all_path,serverPath:n,noDiskserverPath:d,findex:e,successFc:function(e){!function(e){var s=i[e.findex].type;if("add"==s){var n={asset_id:t.assetId,name:i[e.findex].name,local_path:i[e.findex].local_path,type:i[e.findex].file_type,server_path:e.noDiskserverPath,size:i[e.findex].size,mtime:i[e.findex].mtime,disk_id:o.a.file.diskid};Object(l.c)(n).then(function(t){i[e.findex].state=1,c()}).catch(function(t){})}else if("updata"==s){n=[{server_path:e.noDiskserverPath,size:i[e.findex].size,mtime:i[e.findex].mtime,assets_file_id:i[e.findex].file_id,disk_id:o.a.file.diskid}];var d={add_list:"[]",updata_list:a()(n)};Object(l.b)(d).then(function(t){i[e.findex].state=1,c()})}}(e)},progressFc:function(t){},failFc:function(t){}};o.a.file.addUpload(f)},r=function(t,e){window.ue.obj.webgetfilestat(t).then(function(t){var a={};try{a=JSON.parse(t)}catch(t){}!function(t,e){i[e].mtime=t.mtime_tamp,i[e].size=t.fsize;var a=i[e].local_path,n=i[e].mtime;var l=s.findIndex(function(t){return t.local_path==a});l>-1?n==s[l].mtime?(i[e].state=1,c()):(i[e].type="updata",i[e].file_id=s[l].id,f(e)):(i[e].type="add",f(e))}(a,e)}).catch(function(t){})};for(n=0;n<i.length;n++){r(i[n].project_path+i[n].local_path,n)}}}},f=s("2877"),r=Object(f.a)(c,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("d2-container",[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"editeAssetInfoBox"},[s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("预览图")]),s("div",{staticClass:"editeAssetInfoPlayBox"},[s("el-row",t._l(t.assetsMinPlay,function(e,i){return s("el-col",{key:i,attrs:{span:6}},["png"==e.file_type||"jpg"==e.file_type||"jpeg"==e.file_type||"gif"==e.file_type?s("div",{staticClass:"editeAssetInfoImg"},[s("viewer",{ref:"viewer",refInFor:!0,attrs:{images:[e.allPath]}},[s("img",{attrs:{src:e.allPath}})])],1):t._e()])}),1)],1)]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("详情展示图")]),s("div",{staticClass:"editeAssetInfoPlayBox"},[s("el-row",t._l(t.assetsPlayList,function(e,i){return s("el-col",{key:i,attrs:{span:6}},["png"==e.file_type||"jpg"==e.file_type||"jpeg"==e.file_type?s("div",{staticClass:"editeAssetInfoImg"},[s("viewer",{ref:"viewer2",refInFor:!0,attrs:{images:[e.allPath]}},[s("img",{attrs:{src:e.allPath}})])],1):t._e(),"mp4"==e.file_type?s("div",{staticClass:"editeAssetInfoImg"},[s("video",{attrs:{src:e.allPath,controls:"",width:"100%"}})]):t._e()])}),1)],1)]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("资产名称")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.name)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("资产路径")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.local_path)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("资产类型")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.type)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("资产尺寸(xyz)")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.x)+" * "+t._s(t.assetInfo.y)+" * "+t._s(t.assetInfo.z)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("中文名")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.cname)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("上传人")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.assetInfo.creator_name)+"\n          ")])]),s("div",{staticClass:"editeAssetInfoList"},[s("div",{staticClass:"editeAssetInfoTip"},[t._v("上传时间")]),s("div",{staticClass:"editeAssetInfoShow"},[t._v("\n            "+t._s(t.$task.stampToDateTimeM(t.assetInfo.time))+"\n          ")])])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"editeAssetFileTitle"},[s("div",{staticClass:"editeAssetFileHeader"},[t._v("\n          资产文件\n          "),s("div",{staticClass:"editeAssetFileHeaderBtns"},[s("el-button",{attrs:{size:"mini",type:"warning"},on:{click:t.assetUpdataCtr}},[t._v("更新文件")])],1)]),s("div",{staticClass:"editeAssetFileListBox",style:t.fileListHeight},[s("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.assetFileList,function(e,i){return s("div",{key:i,staticClass:"editeAssetFileList"},[s("div",{staticClass:"editeAssetFileName"},[t._v("\n                "+t._s(e.name)+"\n              ")]),s("div",{staticClass:"editeAssetFilePath"},[t._v("\n                "+t._s(e.local_path)+"\n              ")]),s("div",{staticClass:"editeAssetFileSize"},[t._v("\n                "+t._s(t.$task.bToConvert(e.size))+"\n              ")])])}),0)],1),s("div",{staticClass:"editeAssetFileBottom"},[t._v("\n          总数："+t._s(t.assetFileList.length)+"\n        ")])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"editeAssetFileTitle"},[s("div",{staticClass:"editeAssetFileHeader"},[t._v("引用资产")]),s("div",{staticClass:"editeAssetFileListBox",style:t.fileListHeight},[s("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.assetRefList,function(e){return s("div",{key:e.name,staticClass:"editeAssetFileList"},[s("div",{staticClass:"editeAssetFileName"},[t._v("\n                "+t._s(e.name)+"\n              ")]),s("div",{staticClass:"editeAssetFilePath"},[t._v("\n                "+t._s(e.local_path)+"\n              ")])])}),0)],1),s("div",{staticClass:"editeAssetFileBottom"},[t._v("\n          总数："+t._s(t.assetRefList.length)+"\n        ")])])])],1),s("el-dialog",{attrs:{title:"文件列表",visible:t.updataDialog,width:"50%"},on:{"update:visible":function(e){t.updataDialog=e}}},[s("div",{staticClass:"updataDialogBox"},t._l(t.updataList,function(e,i){return s("div",{key:i},[t._v("\n        "+t._s(e.local_path)+"\n      ")])}),0),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.updataDialog=!1}}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.submitUpdata}},[t._v("确 定")])],1)])],1)},[],!1,null,null,null);r.options.__file="editeAsset.vue";e.default=r.exports}}]);